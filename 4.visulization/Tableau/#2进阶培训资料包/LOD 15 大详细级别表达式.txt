15 大详细级别表达式
 https://www.tableau.com/zh-cn/about/blog/LOD-expressions
Tableau 的使命是帮助用户查看并了解数据。我们精心设计了各种功能，帮助用户挖掘数据的价值。 计算是我们专注的一项领域。采用计算语言表达思想的方式越简单，对用户的价值越大。就这点而言，Tableau 9.0 中详细级别表达式的推出是一项重大突破。借助这些新表达式，用户可以使用简单的报表表达强有力的观点。

详细级别表达式可让用户轻松计算不在可视化详细级别层面上的聚合。然后，您便可采用任意方式在可视化视图内整合这些值。这听起来可能很深奥，因此本帖将通过一系列常见问题说明这一概念。在即将结束之时，我们将深入介绍一些更高级的分析示例。详细级别表达式白皮书提供了更全面的概述。要了解关于语法和用法的详细信息，请参阅 Tableau Desktop 在线帮助部分中的详细级别表达式。

下面 15 个工作薄均包含自定义数据源，并且可供下载以获取更多详细信息。如果没有 Tableau Desktop 的副本，您可以在此处获取 14 天免费试用。如果选择按照以下说明重新创建视图，我们建议您使用这些自定义数据源。

1. 客户订单频率

找出每个客户订购的订单数相对简单，但是如果我们想了解订购过一个订单、两个订单、三个订单（依次类推）的客户数目，该怎么办呢？ 要生成相应视图，我们必须按订购的订单数划分客户数。这是一个简单的问题，但是如果没有详细级别表达式，按照某一度量划分另一度量将非常困难。

想一想每个订单包含多个项目的超市销售数据库。各个客户的单独订单数指出了每个客户订购的订单数。只需采用简单的详细级别表达式，即可将订单数转变为按客户数划分的维度。


2. 阵列分析

合作时间越长的客户对销售额的贡献越大吗？ 下面的视图按照客户首次购买的年份将客户分组，以便对比各个阵列的年度销售贡献额。 每个客户的最早订单日期将体现出首次购买日期。不过，由于视图中的数据未按客户显示，我们必须使用详细级别表达式来确定每个客户的最早订单日期。


3. 每日利润 KPI

我们确实可以查看利润随时间的变化趋势，但如果我们想按照每个工作日的总利润来衡量成功，该怎么办？ 我们可能想要了解每个月或每年的盈利天数，尤其是在我们想了解季节影响时。下面的视图显示了在以交易级别记录基础数据的情况下，我们如何利用详细级别表达式轻松根据聚合数据创建分级（例如每日利润）。


4. 总额百分比

每个国家/地区的收入对全球销售额有何贡献？ 如果我们按照贡献百分比着色，即可看出美国对全球销售收入的贡献最大。但是，我们可能想重点关注欧盟等在绝对值上相对贡献较小的市场。如果不采用详细级别表达式，对某市场进行筛选会导致总额百分比的重新计算，从而显示每个国家/地区对其市场的贡献。利用简单的详细级别表达式，我们可对某市场进行筛选，同时仍可衡量全球贡献。


5. 新客户争取率

各个市场总客户争取率的每日趋势如何？ 了解这一数据趋势后，可帮助我们了解地区营销和销售组织在发展新业务方面的表现。线越陡，则争取率趋势越好。如果线逐渐变平，则必须采取一些措施来增加潜在客户流。

详细级别表达式可确保回头客不会误计入新客户，这是因为虽然数据按照市场和天数直观显示，但是必须在客户层面上进行评估。


6. 对比销售额分析

找出与平均值之间的差异相对简单，但是如果您想找出与选定类别的差异，该怎么办？ 首先，您必须隔离选定类别的销售额。然后，您需要使用 EXCLUDE 表达式在所有其他类别中重复该值。之后，您便可轻松了解每个类别的销售额与其他类别的差异。


7. 各个销售代表的平均最大额交易数额

每个销售代表达成的最大交易额是多少？ 然后想一想，对于各个销售代表达成的最大额交易数额，按国家/地区计算的平均值是多少？ 利用详细级别表达式，即使数据按照国家/地区级别直观显示，我们也可以向下查看销售代表详细级别。在下面的视图中，销售代表的平均最大额交易数额在颜色为蓝色的国家/地区较高，而在颜色为橙色的国家/地区较低。我们可以使用这些信息指导对从国家/地区到销售代表的深入分析。


8. 实际对比目标

在本可视化视图中，我们描述了每个州连锁咖啡厅的实际利润与目标利润之间的差异。在顶部视图中，我们可以清楚地看出哪些州超额完成目标，哪些州未完成目标。但是采用这种聚合方式，我们会漏掉重要的细微差别。某些州超出目标是因为在该州销售的每项产品都超出目标。另外一些州超出目标是因为单项产品超额完成其目标，足以弥补未完成目标的所有其他产品。我们可以使用详细级别表达式，确定某州内销售的产品中超出目标产品所占百分比。


9. 周期最后一天的价值

表示具体某天状态的数据（如库存数、员工实际人数或存货的日清算值）需要与可以聚合的指标（例如销售额或利润）区别对待。处理这些数据时，您可能希望显示日历月最后一天的值。此外，我们可能希望从每月下钻到每周后，视图能够更新显示每周最后一天的值。在下面的示例中，我们记录了每天多个时间点的库存数据。该视图对比了平均日清算值和周期最后一天的清算值。使用简单的详细级别表达式，我们可以向下查看每日级别，虽然数据直观显示的是较高级别。


下面 6 个示例说明了详细级别表达式如何应用到更高级的场景，以及利用更广泛的 Tableau 功能集的案例。关于更多基本场景的示例，请观看关于详细级别表达式的按需培训视频。

10. 各个阵列的回头客

争取新客户的成本可能非常高，因此我们希望能够确保现有客户会重复购买。在一个、两个、三个、N 个季度重复购买的客户数目是多少？ 从未重复购买的客户数目是多少？ 如果按季度阵列划分重复购买行为，会怎么样？ 我们可以使用 FIXED 表达式找到每个客户的第一次和第二次购买日期，并从中计算出重复购买的季度数。


11. 一系列平均值的百分比差异

示例 6 说明了如何对比单个选定项，但是如果您想对比一系列值，该怎么办？ 例如，在影响所关注行业的重大事件发生之前，您可能想对比存货的日清算值与平均日清算值。


12. 相对周期筛选

与前一年的年初至今和月初至今进行对比是分析业绩的常用指标。通过筛选相对于今天，我们能够轻松得出分析，但如果数据每周都刷新一次，这时该怎么办？ 假设您最近一次刷新是在 3 月 1 日，但当前日期是 3 月 7 日。月初至今对比会显示前一年 3 月 1 日到 3 月 7 日与今年的 3 月 1 日的对比。这会导致出现严重警报，但这种情况下不该出现警报！ 我们可以采用简单的详细级别表达式找出数据集中的最晚日期。


13. 用户登录频率

每月一次、每两月一次、每三月一次（依次类推）登录网站或应用程序的用户数目是多少？ 平均登录率是多少？ 这一平均值周围的分布偏斜如何？ 数据粒度为每个用户 ID 的登录日期。也就是说，用户登录的每一天都记录为一行。生成此视图需要按照登录率划分客户数，即我们必须按照某个度量划分另一个度量。我们在示例 1 中了解了如何使用详细级别表达式轻松进行此类分析。


14. 成比例笔刷

任何分析中最基本的问题都是：“对比对象是什么？” 在筛选时，我们有时会需要对比所选内容和总量，而不是简单地向下筛选所选内容。这种技巧称为按比例笔刷。


15. 各个客户阵列的年度购买频率

如果合作时间按争取到客户的年份度量，忠诚度按年度购买频率度量，那么合作时间越长的客户越忠诚吗？

从示例 1 中，我们可以精确了解购买过一次、两次（依次类推）的客户数目。然而，营销人员极少需要精确确定购买过五次产品的所有客户。相比之下，了解至少购买过五次产品的客户数目更有用。

另外，我们从示例 2 中了解到，2011 年争取到的客户最多，而 2014 年争取到的客户最少。查看客户的绝对数目只能再次了解同样的趋势。因此，我们应该将每个阵列的客户总额百分比作为度量忠诚度的标准，这样会更意义。

所以最初问题更具体的表达是，在每个阵列中在一年中购买过至少一次、两次、三次、N 次产品的客户所占的百分比是多少？

本示例结合了示例 1 中订单数详细级别表达式的变体、示例 2 中的阵列表达式和示例 4 中的总额百分比表达式的变体。


Read more at https://www.tableau.com/zh-cn/about/blog/LOD-expressions#0vovCKyiJpKwOwwI.99