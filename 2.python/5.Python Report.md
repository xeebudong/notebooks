# Python Report

## 1. ReportLab

### 什么是ReportLab

1. 这个一个允许您使用Python编程语言直接创建PDF格式文件的软件库，它也可以创建各种表格、数据图和位图
2. 今天要介绍的ReportLab可以通过图形命令行直接生成PDF，并且不需要其他辅助，ReportLab可以极快地生成报告。

### 能做什么

1. 通过网页动态生成PDF文档
2. 大量的报告和数据发布
3. 用XML一步生成PDF

### 怎么用

  要使用代码，直接生成pdf，主要就是要解决两方面的问题：一. 页面布局；二. 要素写入；三.格式。要素又包括描述性语言、图片(Python绘制的)、表格及标签等。

1. Platypus

   Platypus是“Page Layout and Typography Using Scripts”，是使用脚本的页面布局和印刷术的缩写，这是一个高层次页面布局库，它可以让你通过编程创造复杂的文档，并且毫不费力。

   Platypus设计的目的是**尽可能地将高层布局设计与文档内容分离**，比如，段落使用段落格式构造，页面使用页面模板，这样做是有好处的，在仅仅修改几行代码的情况下，包含数百个页面的数百个文档就能够被构造成不同的风格。

2. 段落

3. 表格

4. 图片

```python

```

### 参考

1. [用Python快速自动生成图文并茂的PDF文件](https://zhuanlan.zhihu.com/p/318390273)
2. [ReportLab Tutorials](https://www.reportlab.com/documentation/tutorial/)

## 2. LXML，将图表写入HTML

> python 的 [lxml](http://lxml.de/index.html) 库的 [etree](http://lxml.de/tutorial.html) 模块可以实现解析 HTML 代码并写入 html 文件
>
> LXML就是利用Python生成结果展示所需要的HTML+CSS+JS代码，利用LXML生成Python报告时，需要理解：
>
> 页面布局-骨骼：CSS
>
> 内容展示-血肉：HTML
>
> 功能交互-灵魂：JS
>
> 要页面好看，至少是需要设置CSS的，为了方便使用，css只适合做统一的设置

```html
-- HTML+CSS+JS代码框架
<html>
    <head>
        <style type="text/css">
            css代码
        </style>
        <script type="text/javascript" language="javascript">
            js代码
        </script>
    </head>
    <body>
        
    </body>
</html>
```

### 1. HTML

HTML比较简单，在一份数据报告中，需要应用到的HTML元素很少，归纳如下：

div 、 p、table、img

### 2. CSS

最为重要的是，如何去设计你的报告格式，能满足可视化的需要，要注意的内容如下：

- 页面整体布局，边距、边框

- 文字描述p、图片img、表格table的版面布置，在一个div中是处于什么位置

  <img src="E:\notebooks\2.python\0. 资料\0.pic\css-layout.jpg" alt="image-20210811171343366" style="zoom:75%;" />

  > 在上表中，有5个要素，一张表格、一个图片、一个表格标题、一个图片标题、一段文字说明
  >
  > 在设计上，应该是分成3个大div，即表格、图片、文字性描述，其中
  >
  > - 表格div包括 table p
  > - 图片div包括 img p
  >
  > 那么如何用css去实现整个布局呢？
  >
  > 要求：
  >
  > 1. 表格和图片顶部齐平
  > 2. 表格题目和图片题目齐平
  > 3. 如果表格太长或者太高了，可以出现滑动条，上下、左右滑动，以保证图片和表格是对齐的

  ```html
  <html>
  	<head>
  		
  	</head>
  	
  	<body>
  		<style>
  			.wrap{
  				display: flex;
  			}
  			.talbe{width:50%}
  			.img{width: 50%}
  			.img img{display: inline-block;width: 100%;}
  		</style>
  		<div style="text-align: center;">
  			<div style="display: flex;">
  			<div style="width: 50%;position: relative">
  					<table style="display: inline-table;">
  					<tr>
  					    <th>Month</th>
  					    <th>Savings</th>
  					</tr>
  					<tr>
  					    <td>January</td>
  					    <td>$100</td>
  					</tr>
  				</table>
  				<p style="position: absolute;bottom: 0;left: 50%;transform: translateX(-50%);"> Table 1. demo table</p>
  			</div>
  			<div style="width: 50%;">
  				<img style="width: 100%;display: inline-block;" src="https://images.pexels.com/photos/6070351/pexels-photo-6070351.jpeg?auto=compress&cs=tinysrgb&dpr=2&w=500">
  				<p> Pic 1. demo pic</p>
  			</div>
  		</div>
  			<div class="desc"><p> It is a description of the table and pic above</p></div>
  		</div>
  	</body>
  </html>
  ```

  后续：

  	- 加入一些控件，比如折叠的三角标签；比如：章节可折叠

### 3. JS

​        忽略，可以没有交互

### 4. 案例

1. div float设置
2. css设置

```python
# 控制显示格式，将某些模块显示到同一行

# 导入所需模块
import pandas as pd
import matplotlib.pyplot as plt
from io import BytesIO
from lxml import etree
import base64
import urllib
from sklearn import datasets
import warnings
warnings.filterwarnings("ignore")


# 获取数据集，用 urllib 库下载 iris 数据集作为示例
iris = pd.DataFrame(datasets.load_iris().data)
iris.columns = datasets.load_iris().feature_names

# pandas 的 DataFrame 数据直接装换为 html 代码字符串
iris_des = """<div style="float:left"><h1>Iris Describe Stastic</h1>"""+iris.describe().T.to_html()+"</div>"
# iris_des = """<h1>Iris Describe Stastic</h1>"""+iris.describe().T.to_html()

# matplotlib 任意绘制一张图
fig,axes = plt.subplots(1,4,sharey = True)
for n in range(4):
    axes[n].hist( iris.iloc[:,n],bins = 15,color = 'b',alpha = 0.5,rwidth= 0.8 )
    axes[n].set_xlabel(iris.columns[n])
plt.subplots_adjust(wspace = 0)
# figure 保存为二进制文件
buffer = BytesIO()
plt.savefig(buffer)  
plot_data = buffer.getvalue()

# 图像数据转化为 HTML 格式
imb = base64.b64encode(plot_data)  
#imb = plot_data.encode('base64')   # 对于 Python 2.7可用 
ims = imb.decode()
imd = "data:image/png;base64,"+ims
iris_im = """<div style="float:left"><h1>Iris Figure</h1>  """ + """<img src="%s"></div>""" % imd   

root = "<html><head></head><body><title>Iris Dataset</title>"
root = "<html><head><style> table { border-collapse: collapse;} th { background-color: #4CAF50;  color: white;} </style></head><body><title>Iris Dataset</title>" # 在style中设置格式

root = root + iris_des + iris_im + "</body></html>" #将多个 html 格式的字符串连接起来

# lxml 库的 etree 解析字符串为 html 代码，并写入文件
html = etree.HTML(root)
tree = etree.ElementTree(html)
tree.write('iris.html')

# 最后使用默认浏览器打开 html 文件
import webbrowser
webbrowser.open('iris.html',new = 1)
```

## 3. Echart 动态图表

## 4. [HTMLTestRunner](https://cloud.tencent.com/developer/article/1504825)



### 参考资料

1. [python 实现将 pandas 数据和 matplotlib 绘图嵌入 html 文件](https://xinancsd.github.io/Python/imgEmbed2Html.html)
2. [使用python生成本地html文件](https://blog.csdn.net/reallocing1/article/details/51694967)

